# ETL_travel_project

**Автор:** Веремеюк Екатерина

____

 ## **Цель проекта**

Проект предназначен для сбора, обработки и визуализации туристических данных, чтобы предоставить аналитические дашборды для туристического бизнеса. Основная цель — объединение данных из разных источников (API и синтетические данные) и их трансформация для аналитики.

____

## **Источники данных**

Проект использует 2 источника данных:

OpenTripMap API – данные о достопримечательностях, точках интереса и активности туристов. https://dev.opentripmap.org/product

REST Countries API – данные о странах, включая население, географию и популярные туристические направления. https://restcountries.com/

Дополнительно проект генерирует синтетические данные для моделирования туристических потоков, бронирований и визитов.

____

## **Этапы ETL-процесса**

Процесс делится на несколько этапов:

1. *Extraction (извлечение)*

Извлечение данных из API и генерация синтетических данных с помощью Python.

2. *Transformation (обработка)*

Обработка и нормализация данных:

Валидация данных, проверка на пропуски и корректность форматов.

Приведение форматов дат и времени к единому стандарту.

Объединение данных из разных источников.

3. *Loading (загрузка)*

MongoDB – хранение сырых данных (Raw Data).

PostgreSQL (ODS → DDS) – хранение и обработка данных в структурированном виде для аналитики.

ClickHouse – создание аналитической витрины для быстрого построения дашбордов.

## **Визуализация и аналитика**

Metabase используется для построения дашбордов с ключевыми метриками:

Ежедневная сводка по туристическому бизнесу

Эффективность направлений 

Поведение туристов и вовлечённость

## **Оркестрация и автоматизация**

Airflow отвечает за автоматический запуск ETL-процессов

Логирование и уведомления о сбоях через Telegram Bot

## **Технологический стек:**

| Компонент | Используемые технологии |
|:----------------:|:---------:|
| Язык | Python |
| Базы данных | MongoDB, PostgreSQL, ClickHouse | 
| ETL / Оркестрация | Airflow | 
| API | OpenTripMap, REST Countries | 
| Визуализация | Metabase | 
| Уведомления | Telegram Bot | 

## **Пайплайн:**

### 1. Загрузка данных в MongoDB (Raw Layer)

*fetch_data_and_load_to_mongo.py*

DAG, который обращается к API (OpenTripMap, REST Countries) и загружает «сырые» данные в MongoDB

*generate_data_and_load_to_mongo.py*

DAG, который создаёт синтетические данные (туристы, бронирования, поиски, визиты) и также пишет их в MongoDB

**Результат:** в MongoDB лежат все исходные данные (RAW слой). Таблицы: opentripmap_pois_detailed, rest_countries, synthetic_bookings, synthetic_searches, synthetic_tourists, synthetic_visits

![mongo_poi](https://github.com/user-attachments/assets/8d200a21-88d1-4674-8fbd-9200a3a83fb0)

### 2. Инициализация схем в PostgreSQL (ODS + DDS)

*init_schemas_dag.py*

DAG, который создаёт базовые схемы и таблицы в PostgreSQL (ODS и DDS слои).

**Результат:** подготовлена структура БД для загрузки данных.

### 3. Загрузка в ODS (Operational Data Store)

*load_data_to_ods_postgres.py*

DAG, который переносит данные из MongoDB → PostgreSQL (ODS слой).

Результат: данные в ODS приведены к более структурированному виду.

![bookings_table](https://github.com/user-attachments/assets/5205c865-cc7c-40b8-ad5a-4002d3a4607a)

### 4. Трансформация ODS → DDS

*transfer_to_dds_dag.py*

DAG, который берёт данные из ODS и переносит их в DDS слой с удалением дубликатов и валидацмей данных через Pydantic

Результат: готовый слой DDS 

![bookings_table_dds](https://github.com/user-attachments/assets/5b883dc0-990a-4a8f-9e0d-69988ff12134)

### 5. Формирование витрины в ClickHouse

dds_to_clickhouse_dag.py

Загружает данные из DDS в ClickHouse.

Здесь выполняется агрегация и денормализация для расчета метрик и аналитических запросов.

Результат: аналитические витрины доступны для построения дашбордов в Metabase.

![bookings_table_ch](https://github.com/user-attachments/assets/bfaf0e5f-ac25-4cfe-b014-06c0e2c76ad5)












